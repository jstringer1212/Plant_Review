{"version":3,"sources":["../src/index.tsx"],"names":["createPopup","url","title","height","width","left","window","screenX","outerWidth","top","screenY","outerHeight","externalPopup","open","OauthPopup","children","onCode","onClose","externalWindow","setExternalWindow","intervalRef","clearTimer","clearInterval","current","onContainerClick","setInterval","currentUrl","location","href","params","URL","searchParams","code","get","close","error","closed"],"mappings":"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","sourcesContent":["import React, { useEffect, useState, useRef } from 'react';\n\ntype IWindowProps = {\n  url: string;\n  title: string;\n  width: number;\n  height: number;\n};\n\ntype IPopupProps = IWindowProps & {\n  onClose: () => void;\n  onCode: (code: string, params: URLSearchParams) => void;\n  children: React.ReactNode;\n};\n\nconst createPopup = ({\n  url, title, height, width,\n}: IWindowProps) => {\n  const left = window.screenX + (window.outerWidth - width) / 2;\n  const top = window.screenY + (window.outerHeight - height) / 2.5;\n  const externalPopup = window.open(\n    url,\n    title,\n    `width=${width},height=${height},left=${left},top=${top}`,\n  );\n  return externalPopup;\n};\n\nconst OauthPopup: React.FC<IPopupProps> = ({\n  title = '',\n  width = 500,\n  height = 500,\n  url,\n  children,\n  onCode,\n  onClose,\n}: IPopupProps) => {\n  const [externalWindow, setExternalWindow] = useState<Window | null>();\n  const intervalRef = useRef<number>();\n\n  const clearTimer = () => {\n    window.clearInterval(intervalRef.current);\n  };\n\n  const onContainerClick = () => {\n    setExternalWindow(createPopup({\n      url, title, width, height,\n    }));\n  };\n\n  useEffect(() => {\n    if (externalWindow) {\n      intervalRef.current = window.setInterval(() => {\n        try {\n          const currentUrl = externalWindow.location.href;\n          const params = new URL(currentUrl).searchParams;\n          const code = params.get('code');\n          if (!code) {\n            return;\n          }\n          onCode(code, params);\n          clearTimer();\n          externalWindow.close();\n        } catch (error) {\n          // eslint-ignore-line\n        } finally {\n          if (!externalWindow || externalWindow.closed) {\n            onClose();\n            clearTimer();\n          }\n        }\n      }, 700);\n    }\n    return () => {\n      if (externalWindow) externalWindow.close();\n      if (onClose) onClose();\n    };\n  }, [externalWindow]);\n\n  return (\n    // eslint-disable-next-line\n    <div\n      onClick={() => {\n        onContainerClick();\n      }}\n    >\n      { children }\n    </div>\n  );\n};\n\nexport default OauthPopup;\n"],"file":"index.js"}